{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>cake chief admin </title>

    <style>
    .image-upload {
        position: relative;
        display: inline-block;
        margin-right: 10px; /* Space between image inputs */
    }
    
    .image-uploads {
        margin-top: 5px;
        text-align: center;
    }
    
    .crop-button {
        margin-top: 10px;
        margin-bottum: 10px;
        display: none; /* Hide by default, show when an image is uploaded */
    }
    .header-left {
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        width: 100%; /* Ensure it takes full width */
        height: 80px; /* Set a fixed height for the header */
        background-color: #f8f8f8; /* Optional: Add a background color */
    }

    /* Style for the Cake Chief heading */
    .cake-chief-heading {
        font-family: 'Poppins', sans-serif; /* Modern and clean font */
        font-size: 26px; /* Large size for impact */
        color: #1b2850;
        font-weight: 700; /* Bold weight */
        text-transform: uppercase; /* Uppercase for a strong look */
        letter-spacing: 2px; /* Spacing between letters */
        text-align: center; /* Center the text */
        transition: transform 0.3s ease, color 0.3s ease; /* Smooth transitions */
    }

    /* Add a glowing effect */
    .cake-chief-heading::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(211, 60, 60, 0.3), transparent 70%); /* Glow effect */
        transform: translate(-50%, -50%) scale(0); /* Start with no glow */
        transition: transform 0.5s ease; /* Smooth glow animation */
        z-index: -1; /* Place behind the text */
    }

    /* Hover effect */
    .cake-chief-heading:hover {
        color: #1b2850;
         /* Lighter shade of red on hover */
        transform: scale(1.05); /* Slightly enlarge on hover */
    }

    .cake-chief-heading:hover::before {
        transform: translate(-50%, -50%) scale(1); /* Expand glow on hover */
    }

    /* Add a subtle shadow for depth */
    .cake-chief-heading {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }\
    .cropper-container {
        max-width: 100%;
        margin: 20px 0;
    }
    .preview-container {
        margin-top: 10px;
        max-width: 200px;
    }
</style>

    <link rel="icon" href="{% static 'admin_assets\img\Starlogo.png' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/plugins/select2/css/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/bootstrap-datetimepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/plugins/fontawesome/css/fontawesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/plugins/fontawesome/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'admin_assets/css/cropper.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">



</head>

<body>
    <div id="global-loader">
        <div class="whirly-loader"> </div>
    </div>

    <div class="main-wrapper">

        <div class="header">

            <div class="header-left active">
                <a href="{% url "dashboard" %}" class="logo">
                    <h2 class="cake-chief-heading">Cake Chief</h2>           
                  </a>
                <a href="{% url 'dashboard' %}" class="logo-small">
                    <img src="{% static 'admin_assets\img\logo\logo-small.png' %}" alt="">

                </a>
                <a id="toggle_btn" href="javascript:void(0);">
                </a>
            </div>

            <a id="mobile_btn" class="mobile_btn" href="#sidebar">
                <span class="bar-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </a>

            <ul class="nav user-menu">
                <li class="nav-item dropdown has-arrow main-drop">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img src="{% static 'admin_assets/img/profiles/avatoradmn.jpg' %}" alt="">
                            <span class="status online"></span></span>
                    </a>
                    <div class="dropdown-menu menu-drop-user">
                        <div class="profilename">
                            <div class="profileset">
                                <span class="user-img"><img src="{% static 'admin_assets/img/profiles/avatoradmn.jpg' %}" alt="">
                                    <span class="status online"></span></span>
                              
                            </div>
                            <hr class="m-0">
                             
                            <hr class="m-0">
                            <a class="dropdown-item logout pb-0" href="{% url "home:logout" %}"><img
                                    src="{% static 'admin_assets/img/icons/log-out.svg' %}" class="me-2" alt="img">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>


            <div class="dropdown mobile-user-menu">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="profile.html">My Profile</a>
                    <a class="dropdown-item" href="generalsettings.html">Settings</a>
                    <a class="dropdown-item logout pb-0" href="{% url "home:logout" %}"><img
                        src="{% static 'admin_assets/img/icons/log-out.svg' %}" class="me-2" alt="img">Logout</a>                                </div>
            </div>

        </div>


        <div class="sidebar" id="sidebar">
            <div class="sidebar-inner slimscroll">
                <div id="sidebar-menu" class="sidebar-menu">
                    <ul>
                        <li>
                            <a href="{% url "dashboard" %}"><img src="{% static 'admin_assets/img/icons/dashboard.svg' %}" alt="img">
                                    <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="submenu">
                            <a href="javascript:void(0);">
                                <img src="{% static 'admin_assets/img/icons/product.svg' %}" alt="img">
                                <span>Product </span> <span class="menu-arrow"></span>
                            </a>
                            <ul class="submenu-content">
                                <li><a href="{% url 'product_list' %}">Product List</a></li>
                                <li><a href="{% url 'add_products' %}">Add Product</a></li>
                            </ul>
                        </li>

                        <li class="submenu">
                            <a href="javascript:void(0);">
                                <img src="{% static 'admin_assets/img/icons/category.svg' %}" alt="img">
                                <span>Category </span> <span class="menu-arrow"></span>
                            </a>
                            <ul class="submenu-content">
                                <li><a href="{% url 'category_list' %}">Category List</a></li>
                                <li><a href="{% url 'add_category' %}">Add Category</a></li>
                            </ul>
                        </li>

                        <li class="submenu">
                            <a href="javascript:void(0);">
                                <img src="{% static 'admin_assets/img/icons/flavour.svg' %}" alt="img">
                                <span>Flavour </span> <span class="menu-arrow"></span>
                            </a>
                            <ul class="submenu-content">
                                <li><a href="{% url 'flavour_list' %}">Flavour List</a></li>
                                <li><a href="{% url 'add_flavour' %}">Add Flavour</a></li>
                            </ul>
                        </li>

                        <li class="submenu">
                            <a href="javascript:void(0);">
                                <img src="{% static 'admin_assets/img/icons/coupon.svg' %}" alt="img">
                                <span>Coupon </span> <span class="menu-arrow"></span>
                            </a>
                            <ul class="submenu-content">
                                <li><a href="{% url 'coupon_list' %}">List Coupons</a></li>
                            </ul>
                        </li>

                     
                        <li class="submenu">
                            <a href="javascript:void(0);"><img src="{% static 'admin_assets/img/icons/users1.svg' %}"
                                    alt="img"><span>
                                    Users</span>
                                <span class="menu-arrow"></span></a>
                            <ul>
                                
                                <li><a href="{% url "user_management" %}">Users
                                        List</a>
                                </li>
                            </ul>
                        </li>
                        <li class="submenu">
                            <a href="javascript:void(0);"><img src="{% static 'admin_assets/img/icons/order.svg' %}" alt="img">
                                <span>order</span> <span class="menu-arrow"></span>
                            </a>
                            <ul class="submenu-content">
                                <li><a href="{% url 'order_app:admin_order_list' %}">Order List</a></li>
                            </ul>
                        </li>
                        <li>{% if messages %}
                            {% for message in messages %}
                            <div class="alert 
                            {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% elif message.tags == 'info' %}alert-info{% endif %}
                            alert-dismissible fade show custom-alert" role="alert">  
                                    {{ message }}
                                </div>
                            {% endfor %}
                            <script>
                                // Dismiss alert messages after 5 seconds
                                setTimeout(function() {
                                    const alerts = document.querySelectorAll('.alert');
                                    alerts.forEach(alert => alert.classList.remove('show'));
                                }, 5000); // 5000 ms = 5 seconds
                            </script>
                        {% else %}
                            
                        {% endif %}
                    </li>
                       
                    </ul>
                </div>
            </div>
        </div>

        <div class="page-wrapper">
            <div class="content">
                <div class="page-header">
                    <div class="page-title">
                        <h4>Product Add</h4>
                        <h6>Create new product</h6>
                    </div>
                </div>
        
                <div class="card">
                    <div class="card-body">
                        <form action="{% url 'add_products' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label>Product Name</label>
                                        <input type="text" placeholder="Enter product Name" name="product_name" required class="form-control" >
                                    </div>
                                </div>
        
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label>Category</label>
                                        <select name="category" class="select form-control" required>
                                            <option value="" disabled selected>Select Category</option>
                                            {% for cate in categories %}
                                            <option value="{{cate.id}}">{{cate.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
        
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label>Flavours</label>
                                        <select name="flavour" class="select form-control" required>
                                            <option value="" disabled selected>Select Flavour</option>
                                            {% for flav in flavours %}
                                            <option value="{{flav.id}}">{{flav.name}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                             
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Description</label>
                                        <textarea name="description" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>

                                <!-- Variants Card -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Product Variants</h5>
                <button type="button" class="btn btn-sm btn-primary" id="addVariant">
                    <i class="bi bi-plus-lg"></i> Add Variant
                </button>
            </div>
            <div class="card-body">
                <div id="variantsContainer">
                    <div class="variant-item border rounded p-3 mb-3">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">weight</label>
                                <select class="form-select" name="varient_weight[]">
                                    <option value="0.5kg" {% if varient.weight == '0.5kg' %}selected{% endif %}>0.5kg</option>
                                    <option value="1kg" {% if varient.weight == '1kg' %}selected{% endif %}>1kg</option>
                                    <option value="1.5kg" {% if varient.weight == '1.5kg' %}selected{% endif %}>1.5kg</option>
                                    <option value="2kg" {% if varient.weight == '2kg' %}selected{% endif %}>2kg</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Price</label>
                                <input type="number" class="form-control" name="varient_price[]" value="{{ varient.price }}" min="0" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Stock</label>
                                <input type="number" class="form-control" name="varient_stock[]" value="{{ varient.stock }}" min="0" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">&nbsp;</label>
                                <button type="button" class="btn btn-danger d-block w-100 remove-variant">
                                    <i class="bi bi-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
                                <!-- Main Product Image -->
                                <div class="col-lg-3 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label>Main Product Image:</label>
                                        <input type="file" id="mainImageInput" name="main_product_image" accept="image/*" class="form-control" required>
                                        <div id="mainImagePreview" class="mt-2" style="width: 200px;">
                                            <!-- Image preview will be displayed here -->
                                        </div>
                                    </div>
                                </div>

            
                                <!-- Additional Product Images -->
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label>Additional Product Images (Upload at least 3 images):</label>
                                        <div id="additionalImageInputs" class="d-flex flex-wrap">
                                            {% for i in 3|range %}
                                            <div class="image-upload me-2">
                                                <input type="file" name="additional_product_image_{{i}}" 
       id="additionalImageInput{{i}}" 
       accept="image/*" class="form-control" 
       required onchange="previewImage(this, {{i}})">

                                                <div class="image-uploads">
                                                    <img src="{% static 'admin_assets/img/icons/upload.svg' %}" alt="img" style="width: 40px; height: auto;">
                                                    <h4>Drag and drop files to upload</h4>
                                                </div>
                                            </div>
                                            <div id="additionalImagePreview{{i}}" class="mt-2" style="width:300px">
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>

                                <div id="cropContainer" style="display:none; position: relative; ">
                                </div>
        
                                <div class="col-lg-12">
                                    <button type="submit" class="btn btn-submit me-2">Submit</button>
                                    <a href="{% url 'product_list' %}" class="btn btn-cancel">Cancel</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'admin_assets/js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/feather.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/jquery.slimscroll.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'admin_assets/plugins/select2/js/select2.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/moment.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/bootstrap-datetimepicker.min.js' %}"></script>
    <script src="{% static 'admin_assets/js/script.js' %}"></script>
    <script src="https://unpkg.com/cropperjs/dist/cropper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
const IMAGE_CONFIG = {
    main: {
        width: 539,
        height: 539,
        aspectRatio: 1,
        required: true
    },
    additional: {
        width: 539,
        height: 539,
        aspectRatio: 1,
        minCount: 3,
        required: true
    }
};

class ImageUploadHandler {
    constructor() {
        this.croppers = new Map();
        this.initialize();
    }

    initialize() {
        this.setupMainImageUpload();
        this.setupAdditionalImagesUpload();
        this.setupFormValidation();
    }

    setupMainImageUpload() {
        const mainInput = document.getElementById('mainImageInput');
        if (!mainInput) return;

        mainInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                this.handleImageUpload(file, 'main', {
                    cropContainerId: 'cropContainer',
                    previewId: 'mainImagePreview',
                    inputId: 'mainImageInput'
                });
            }
        });
    }

    setupAdditionalImagesUpload() {
        for (let i = 0; i < 3; i++) {
            const input = document.getElementById(`additionalImageInput${i}`);
            if (!input) continue;

            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    this.handleImageUpload(file, 'additional', {
                        cropContainerId: 'cropContainer',
                        previewId: `additionalImagePreview${i}`,
                        inputId: `additionalImageInput${i}`,
                        index: i
                    });
                }
            });
        }
    }

    handleImageUpload(file, type, config) {
        if (!file.type.startsWith('image/')) {
            alert('Please upload an image file');
            return;
        }
    
        if (file.size > 5 * 1024 * 1024) {
            alert('Image size should be less than 5MB');
            return;
        }
    
        const reader = new FileReader();
        reader.onload = (e) => {
            this.previewImage(e.target.result, config.previewId);
            this.initCropper(e.target.result, type, config);
        };
        reader.readAsDataURL(file);
    }
    
    previewImage(imageData, previewId) {
        let previewContainer = document.getElementById(previewId);
        if (previewContainer) {
            previewContainer.innerHTML = `<img src="${imageData}" style="width:100%; max-height: 200px; object-fit: cover;">`;
        }
    }
    

    initCropper(imageData, type, config) {
        const cropContainer = document.getElementById(config.cropContainerId);
        if (!cropContainer) return;

        if (this.croppers.has(config.inputId)) {
            this.croppers.get(config.inputId).destroy();
        }

        cropContainer.innerHTML = `
            <div class="crop-container">
                <img src="${imageData}" class="crop-target">
                <div class="crop-controls mt-3">
                    <button type="button" class="btn btn-primary crop-confirm" style="margin-bottom: 20px;">Confirm Crop</button>
                    <button type="button" class="btn btn-secondary crop-cancel" style="margin-bottom: 20px;">Cancel</button>
                </div>
            </div>
        `;
        cropContainer.style.display = 'block';

        const image = cropContainer.querySelector('.crop-target');
        const cropper = new Cropper(image, {
            aspectRatio: IMAGE_CONFIG[type].aspectRatio,
            viewMode: 1,
            autoCropArea: 1,
            responsive: true
        });

        this.croppers.set(config.inputId, cropper);

        cropContainer.querySelector('.crop-confirm').addEventListener('click', () => {
            this.processCroppedImage(cropper, type, config);
        });

        cropContainer.querySelector('.crop-cancel').addEventListener('click', () => {
            this.cancelCrop(config);
        });
    }

    processCroppedImage(cropper, type, config) {
        console.log('cropper is working');
        const canvas = cropper.getCroppedCanvas({
            width: IMAGE_CONFIG[type].width,
            height: IMAGE_CONFIG[type].height
        });

        canvas.toBlob((blob) => {
            const croppedFile = new File([blob], 'cropped_image.png', { type: 'image/png' });
            const input = document.getElementById(config.inputId);
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(croppedFile);
            input.files = dataTransfer.files;

            const preview = document.getElementById(config.previewId);
            if (preview) {
                preview.innerHTML = `<img src="${URL.createObjectURL(croppedFile)}" alt="Cropped Image" style="width: 200px; height: auto;">`;
                preview.style.display = 'block';
            }

            this.cleanupCropper(config);
        }, 'image/png');
    }

    cancelCrop(config) {
        const input = document.getElementById(config.inputId);
        if (input) input.value = '';

        const preview = document.getElementById(config.previewId);
        if (preview) {
            preview.innerHTML = '';
            preview.style.display = 'none';
        }

        this.cleanupCropper(config);
    }

    cleanupCropper(config) {
        if (this.croppers.has(config.inputId)) {
            this.croppers.get(config.inputId).destroy();
            this.croppers.delete(config.inputId);
        }

        const cropContainer = document.getElementById(config.cropContainerId);
        if (cropContainer) {
            cropContainer.style.display = 'none';
            cropContainer.innerHTML = '';
        }
    }

    setupFormValidation() {
        const form = document.querySelector('form');
        if (!form) return;

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const mainImage = document.getElementById('mainImageInput');
            if (IMAGE_CONFIG.main.required && (!mainImage || !mainImage.files[0])) {
                alert('Please upload a main product image');
                return;
            }

            let additionalImagesCount = 0;
            for (let i = 0; i < 3; i++) {
                const input = document.getElementById(`additionalImageInput${i}`);
                if (input && input.files[0]) additionalImagesCount++;
            }

            if (IMAGE_CONFIG.additional.required && additionalImagesCount < IMAGE_CONFIG.additional.minCount) {
                alert(`Please upload at least ${IMAGE_CONFIG.additional.minCount} additional images`);
                return;
            }

            form.submit();
        });
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new ImageUploadHandler();
});



        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const variantsContainer = document.getElementById('variantsContainer');
                const addVariantBtn = document.getElementById('addVariant');
            
                addVariantBtn.addEventListener('click', function() {
                    const variantHTML = `
                        <div class="variant-item border rounded p-3 mb-3">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">weight</label>
                                    <select class="form-select" name="varient_weight[]">
                                        <option value="0.5kg">0.5kg</option>
                                        <option value="1kg">1kg</option>
                                        <option value="1.5kg">1.5kg</option>
                                        <option value="2kg">2kg</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Price</label>
                                    <input type="number" class="form-control" name="varient_price[]" required>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Stock</label>
                                    <input type="number" class="form-control" name="varient_stock[]" required>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="button" class="btn btn-danger d-block w-100 remove-variant">
                                        <i class="bi bi-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    variantsContainer.insertAdjacentHTML('beforeend', variantHTML);
                });
            
                variantsContainer.addEventListener('click', function(e) {
                    if (e.target.closest('.remove-variant')) {
                        e.target.closest('.variant-item').remove();
                    }
                });
            });
            </script>
    
    

    
    




</body>

</html>


